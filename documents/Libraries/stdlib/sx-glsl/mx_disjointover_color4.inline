({{fg}}.w+{{bg}}.w < 1.0) ?
( vec2( {{fg}}.xyz + {{bg}}.xyz, min({{fg}}.w + {{bg}}.w, 1.0) ) * {{mix}} :
  vec2( {{fg}}.xyz + ({{bg}}.xyz * (1.0-{{fg}}.w)/{{bg}}.w ), min({{fg}}.w + {{bg}}.w, 1.0) ) * {{mix}} )
+ ({{bg}} * (1.0-{{mix}}));
